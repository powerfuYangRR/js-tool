# 对CSRF的了解

1. 首先，登录权限验证的方式有很多种，目前呢，绝大多数网站采用的还是使用cookie-session认证的一种方式，session机制简单的说就是客户端去使用一个键值对来记录你的登录信息，同时在cookie中将你的SessionID，也就刚才说的键值对里面的键存储到你的cookie中，另外，我们也知道，浏览器http请求呢，他是会自动把token带上，传给服务端的，这样的话，在每次请求的时候通过cookie去获取它的SessionID，然后通过它在服务端去获取它的登录信息，就可以完成一个用户权限的校验。本来呢，这也是一个不错的功能，但是由于现在的cookie实在太开放了，如果一个用户在a网站登录了，然后他再去登录b网站的时候发送了一个a网站的请求，那么这个请求呢，它里面是带有这个用户在a网站里面的登录信息的，那么如果这个时候b网站里面发送的a网站请求，用户不知道的话，那就是一个非常严重的危害了。以上的这个过程呢，就是跨站请求攻击，它的全称是Cross Site Request Forgery，也就是CSRF的全称。

2. 那么它有什么危害呢，简单总结呢，CSRF漏洞就是利用网站权限校验方面的漏洞，在用户不知觉的情况下去发送请求，达到一个伪装用户的目的

3. 那它利用CSRF可以实现以下几种攻击：
> 1. 攻击者能够欺骗受害用户，完成该用户所允许的任意状态改变的操作，比如说更新账号的细节，完成购物，促销，甚至是登录的操作
> 2. 它是可以去获取用户的一些隐私数据
> 3. 它能够配合其它的漏洞攻击
> 4. 叫做CSRF蠕虫，其实，CSRF蠕虫呢，它指的是产生蠕虫效果，会将CSRF攻击一传十十传百，比如说啊，举个例子，某个社区它私信好友的接口，还有获取它好友列表的接口，都有CSRF漏洞，那么攻击者就可以将其组合成一个蠕虫，当一个用户访问恶意页面后，通过CSRF获取其好友信息，然后再利用私信好友的CSRF漏洞给每个好友都发送这样一条指向恶意页面的信息，那么只要有人查看了这个信息里面的链接，那么这个蠕虫就是在不断的传播，它所造成的危害和影响是非常巨大的

4. 这种攻击有什么防御方法呢，我们知道CSRF呢，有两个特点：
> 1. 利用cookie自身携带的特性
> 2. 它可以跨站攻击

5. 那么针对这两种特性，可以使用以下的几个解决办法：
> 1. 去检查http头中的一个Referer字段，这个字段它是用来标明请求来源于那个地址，通过在网站中校验请求该字段，我们就知道请求是那边发出来的，它是不是从本站发出来的，那如果不是从本站发出来的，我们就可以去拒绝一切非本站发出的请求，这样就避免于CSRF跨站的一个特性
> 2. 就是通过token验证，因为CSRF呢，他是利用了浏览器在自动传递cookie的特性，另外一个防御思路呢，就是校验信息不通过cookie来传递，在其它参数中增加随机加密串来进行一个校验，这样也可以解决CSRF攻击的方法
> 3. 如果不用token来传递的话，我们可以有几个办法来实现这个校验信息，我这里只说两个方法：
>> 1. 叫做随机字符串，就是为每一个提交增加一个随机字符串的一个参数，该参数呢，服务器通过页面下发，每次请求的时候补充到你的提交参数里面，服务端通过去校验该参数是否一致，来判断是否是用户的请求。如果CSRF攻击者他事先是无法得知这个随机字符串里面的值，所以服务端就可以去通过校验该值来拒绝他们的请求
>> 2. 就是通过JWT，实际上了，除了session登录以外，现在越来越流行JWT Token来验证，该方式是在前端记录一个token，每次请求的时候通过在Header里面添加认证头的方式来实现登录校验过程，由于CSRF攻击它是无法去得知你这个cookie的值，所以说通过这种方式也是可以去防止CSRF攻击的
